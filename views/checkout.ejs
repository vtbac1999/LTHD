<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Ogani Template" />
    <meta name="keywords" content="Ogani, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Ogani</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
    <script src="https://www.paypal.com/sdk/js?client-id=AbRnw6VYbjNYXz0lpXGs6rLi96qBRV9cAi7tC1kGC6b7O9lqgOVPx9Vpq-Bqwi3-N8QzjRnKazrxvLIS&disable-funding=card&buyer-country=VN"></script> -->
    <script src="https://sbgateway.zalopay.vn/openinapp?order="></script>
  </head>

  <body>
    <!-- Page Preloder -->
    <!-- <div id="preloder">
        <div class="loader"></div>
    </div> -->

    <!-- Humberger Begin -->
    <div class="humberger__menu__overlay"></div>
    <div class="humberger__menu__wrapper">
      <div class="humberger__menu__logo">
        <a href="#"><img src="img/logo.png" alt="" /></a>
      </div>
      <div class="humberger__menu__cart">
        <ul>
          <!-- <li><a href="#"><i class="fa fa-heart"></i> <span>1</span></a></li> -->
          <li>
            <a href="/shoping-cart"
              ><i class="fa fa-shopping-bag"></i>
              <span><%=session.totalQty%></span></a
            >
          </li>
        </ul>
        <div class="header__cart__price"></div>
      </div>
      <div class="humberger__menu__widget">
        <!-- <div class="header__top__right__language">
                <img src="img/language.png" alt="">
                <div>English</div>
                <span class="arrow_carrot-down"></span>
                <ul>
                    <li><a href="#">Spanis</a></li>
                    <li><a href="#">English</a></li>
                </ul>
            </div> -->
        <!-- <div class="header__top__right__auth">
                <a href="#"><i class="fa fa-user"></i> Login</a>
            </div> -->
      </div>
      <nav class="humberger__menu__nav mobile-menu">
        <ul>
          <li class="active"><a href="/index">Home</a></li>
          <li><a href="/shop-grid">Shop</a></li>
          <li>
            <a href="#">Pages</a>
            <ul class="header__menu__dropdown">
              <!-- <li><a href="/shop-details">Shop Details</a></li> -->
              <li><a href="/shoping-cart">Shoping Cart</a></li>
              <li><a href="/checkout">Check Out</a></li>
              <!-- <li><a href="/blog-details">Blog Details</a></li> -->
            </ul>
          </li>
          <!-- <li><a href="/blog">Blog</a></li> -->
          <li><a href="/contact">Contact</a></li>
          <li><a href="/about">About us</a></li>
        </ul>
      </nav>
      <div id="mobile-menu-wrap"></div>
      <!-- <div class="header__top__right__social">
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-linkedin"></i></a>
            <a href="#"><i class="fa fa-pinterest-p"></i></a>
        </div> -->
      <!-- <div class="humberger__menu__contact">
            <ul>
                <li><i class="fa fa-envelope"></i> hello@colorlib.com</li>
                <li>Free Shipping for all Order of $99</li>
            </ul>
        </div> -->
    </div>
    <!-- Humberger End -->

    <!-- Header Section Begin -->

    <header class="header">
      <div class="header__top">
        <div class="container">
          <div class="row">
            <div class="col-lg-6 col-md-6">
              <!-- <div class="header__top__left">
                            <ul>
                                <li><i class="fa fa-envelope"></i> hello@colorlib.com</li>
                                <li>Free Shipping for all Order of $99</li>
                            </ul>
                        </div> -->
            </div>
            <div class="col-lg-6 col-md-6">
              <div class="header__top__right">
                <!-- <div class="header__top__right__social">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-linkedin"></i></a>
                                <a href="#"><i class="fa fa-pinterest-p"></i></a>
                            </div> -->
                <!-- <div class="header__top__right__language">
                                <img src="img/language.png" alt="">
                                <div>English</div>
                                <span class="arrow_carrot-down"></span>
                                <ul>
                                    <li><a href="#">Spanis</a></li>
                                    <li><a href="#">English</a></li>
                                </ul>
                            </div> -->
                <!-- <div class="header__top__right__auth">
                                <a href="#"><i class="fa fa-user"></i> Login</a>
                            </div> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-lg-3">
            <div class="header__logo">
              <a href="/index"><img src="img/logo.png" alt="" /></a>
            </div>
          </div>
          <div class="col-lg-6">
            <nav class="header__menu">
              <ul>
                <li><a href="/index">Home</a></li>
                <li class="active"><a href="/shop-grid">Shop</a></li>
                <li>
                  <a href="#">Pages</a>
                  <ul class="header__menu__dropdown">
                    <!-- <li><a href="/shop-details">Shop Details</a></li> -->
                    <li><a href="/shoping-cart">Shoping Cart</a></li>
                    <li><a href="/checkout">Check Out</a></li>
                    <!-- <li><a href="/blog-details">Blog Details</a></li> -->
                  </ul>
                </li>
                <!-- <li><a href="/blog">Blog</a></li> -->
                <li><a href="/contact">Contact</a></li>
                <li><a href="/about">About us</a></li>
              </ul>
            </nav>
          </div>
          <div class="col-lg-3">
            <div class="header__cart">
              <ul>
                <!-- <li><a href="#"><i class="fa fa-heart"></i> <span>1</span></a></li> -->
                <li>
                  <a href="/shoping-cart"
                    ><i class="fa fa-shopping-bag"></i>
                    <span><%=session.totalQty%></span></a
                  >
                </li>
              </ul>
              <div class="header__cart__price"></div>
            </div>
          </div>
        </div>
        <div class="humberger__open">
          <i class="fa fa-bars"></i>
        </div>
      </div>
    </header>

    <!-- Header Section End -->

    <!-- Hero Section Begin -->
    <%- include('selection'); %>
    <!-- Hero Section End -->
    <%- include('validateemail'); %>
    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-section set-bg" data-setbg="img/breadcrumb.jpg">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-center">
            <div class="breadcrumb__text">
              <h2>Checkout</h2>
              <div class="breadcrumb__option">
                <a href="/index">Home</a>
                <span>Checkout</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Checkout Section Begin -->
    <section class="checkout spad">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <h6>
              <span class="icon_tag_alt"></span> Have a coupon?
              <a href="/shoping-cart">Click here</a> to enter your code
            </h6>
          </div>
        </div>
        <div class="checkout__form">
          <h4>Billing Details</h4>

          <div class="row">
            <div class="col-lg-6 col-md-6">
              <div class="row">
                <div class="col-lg-6">
                  <div class="checkout__input">
                    <p>First Name<span>*</span></p>
                    <input id="fn" type="text" />
                    <p id="efn" style="color: red;"></p>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="checkout__input">
                    <p>Last Name<span>*</span></p>
                    <input id="ln" type="text" />
                    <p id="eln" style="color: red;"></p>
                  </div>
                </div>
              </div>
              
              <!-- <div class="checkout__input">
                <p>Country<span>*</span></p>
                <input type="text" />
              </div> -->
              <div class="checkout__input">
                <p>Address<span>*</span></p>
                <input
                  id="ad"
                  type="text"
                  placeholder="Street Address"
                  class="checkout__input__add"
                />
                <p id="ead" style="color: red;"></p>
                <input
                  id="ad1"
                  type="text"
                  placeholder="Apartment, suite, unite ect (optinal)"
                />
                <p id="ead1" style="color: red;"></p>
              </div>
              <div class="checkout__input">
                <p>Town/City<span>*</span></p>
                <input id="city" type="text" />
                <p id="ecity" style="color: red;"></p>
              </div>
             
              <div class="row">
                <div class="col-lg-6">
                  <div class="checkout__input">
                    <p>Phone<span>*</span></p>
                    <input id="phone" type="text" />
                    <p id="ephone" style="color: red;"></p>
                  </div>
                </div>

                <div class="col-lg-6">
                  <div class="checkout__input">
                    <p>Email<span>*</span></p>
                    <input id="emailbill" type="text" />
                    <p id="eemailbill" style="color: red;"></p>
                  </div>
                </div>
              </div>
              <!-- <div class="checkout__input__checkbox">
                                <label for="acc">
                                    Create an account?
                                    <input type="checkbox" id="acc">
                                    <span class="checkmark"></span>
                                </label>
                            </div> -->
              <!-- <p>Create an account by entering the information below. If you are a returning customer
                                please login at the top of the page</p> -->
              <!-- <div class="checkout__input">
                                <p>Account Password<span>*</span></p>
                                <input type="text">
                            </div> -->
              <!-- <div class="checkout__input__checkbox">
                                <label for="diff-acc">
                                    Ship to a different address?
                                    <input type="checkbox" id="diff-acc">
                                    <span class="checkmark"></span>
                                </label>
                            </div> -->
              <div class="checkout__input">
                <p>Order notes<span>*</span></p>
                <input
                  id="note"
                  type="text"
                  placeholder="Notes about your order, e.g. special notes for delivery."
                />
              </div>
            </div>
            <div class="col-lg-6 col-md-6">
              <div class="checkout__order">
                <h4>Your Order</h4>
                <div class="checkout__order__products">
                  Products <span>Total</span>
                </div>
                <ul>
                  <% getcart.forEach(e=>{%>
                  <li><%=e.item.tensp%> <span><%=e.totalprice%> VNĐ</span></li>
                  <%})%>
                </ul>
                <div class="checkout__order__subtotal">
                  Subtotal <span><%=session.totalPrice%> VNĐ</span>
                </div>
                <div class="checkout__order__total">
                  Discount(%) <span>-<%=coupon%></span>
                </div>
                <div class="checkout__order__total">
                  Total
                  <span id="total_bill"
                    ><%=(100-coupon)*session.totalPrice/100%> VNĐ</span
                  >
                </div>

                <div class="checkout__input__checkbox">
                  <label for="payment">
                    Cash On Delivery
                    <input type="checkbox" id="payment" />
                    <span class="checkmark"></span>
                  </label>
                </div>

                <div class="checkout__input__checkbox">
                  <label for="paypal">
                    Paypal
                    <input type="checkbox" id="paypal" />
                    <span class="checkmark"></span>
                  </label>
                </div>

                <!-- <div class="checkout__input__checkbox">
                  <label for="zalopay">
                    ZaloPay 
                    <input type="checkbox" id="zalopay" />
                    <span class="checkmark"></span>
                  </label>
                </div> -->

               

                <div style="display: none;" id="paypal-button-container"></div>
                <!-- <form action="/buy" method="POST"> -->

            
                <!-- <button style="display: none;" type="submit" id="zalopay-btn" class="site-btn"  >
                  Zalo Pay
                </button> -->


                <button type="submit" class="site-btn" disabled>
                  PLACE ORDER
                </button>
                <!-- </form> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Checkout Section End -->

    <!-- Footer Section Begin -->
    <%- include('footer'); %>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>

    <script>
      $(document).ready(() => {

       



      


        function getnumbertoconvervndtousd(callback) {
          $.ajax({
            url:
              'https://free.currconv.com/api/v7/convert?q=VND_USD&compact=ultra&apiKey=925acffac404d631739e',
            method: 'get',
            contentType: 'application/json',
            success: (res) => {
              callback(res);
            },
          });
        }
        let vnd = $('#total_bill').text();
        const getresponse = getnumbertoconvervndtousd((value) => {
          console.log("CC Tinh phan "+value.VND_USD);
          vnd = parseFloat(vnd) * value.VND_USD;
        });

        var flagpaypal = false;
        paypal
          .Buttons({
            createOrder: function (data, actions) {
              // This function sets up the details of the transaction, including the amount and line item details.
              console.log(data);
              console.log(actions.order);
              return actions.order.create({
                purchase_units: [
                  {
                    amount: {
                      currency_code: 'USD',
                      value: vnd.toFixed(2),
                    },
                  },
                ],
              });
            },
            onApprove: function (data, actions) {
              // This function captures the funds from the transaction.
              return actions.order.capture().then(function (details) {
                // This function shows a transaction success message to your buyer.
                flagpaypal = true;
                alert(
                  'Transaction completed by ' + details.payer.name.given_name
                );
              });
            },
          })
          .render('#paypal-button-container');

        ////////////////////////////


        
        $('#payment').click(() => {
          let getcheck = $('#payment').is(':checked');
          if (getcheck == true) {
            $('#paypal-button-container').css('display', 'none');
            $('#paypal').prop('checked', false);
            $('.site-btn').prop('disabled', false);
          } else {
            $('.site-btn').prop('disabled', true);
          }
         

        });

        $('#paypal').click(() => {
          let getcheck = $('#paypal').is(':checked');
          if (getcheck == true) {
            $('#paypal-button-container').css('display', 'block');
            $('#payment').prop('checked', false);
            $('.site-btn').prop('disabled', false);
          } else {
            $('#paypal-button-container').css('display', 'none');
            $('.site-btn').prop('disabled', true);
          }
        });

        $('#zalopay').click(() => {

          // let getcheck = $('#zalopay').is(':checked');
          // if (getcheck == true) {
          //   $('#zalopay-btn').css('display', 'block');
          //   $('#payment').prop('checked', false);
          //   $('#paypal').prop('checked', false);
          //   $('.site-btn').prop('disabled', false);
          // } else {
          //   $('#zalopay-btn').css('display', 'none');
          //   $('.site-btn').prop('disabled', true);
          // }

          
          
           
            
            
        });



        function checkemailbill(email, cb) {
          $.ajax({
            url: '/validateemail',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ email: email }),
            success: (res) => {
              cb(res);
            },
          });
        }

        function checkin4() {
          let getfn = $('#fn');
          let getln = $('#ln');
          let getad = $('#ad');
          let getad1 = $('#ad1');
          let getcity = $('#city');
          let getphone = $('#phone');
          let getemailbill = $('#emailbill');
          let getnote = $('#note');
          if (getfn.val().length == 0) {
            getfn.focus();
            $('#efn').text('Please valid your first name !!!');
            return false;
          } else {
            $('#efn').text('');
          }

          if (getln.val().length == 0) {
            getln.focus();
            $('#eln').text('Please valid your last name !!!');
            return false;
          } else {
            $('#eln').text('');
          }

          if (getad.val().length == 0) {
            getad.focus();
            $('#ead').text('Please valid your address !!!');
            return false;
          } else {
            $('#ead').text('');
          }

          if (getad1.val().length == 0) {
            getad1.focus();
            $('#ead1').text('Please valid apartment !!!');
            return false;
          } else {
            $('#ead1').text('');
          }

          if (getcity.val().length == 0) {
            getcity.focus();
            $('#ecity').text('Please valid your city !!!');
            return false;
          } else {
            $('#ecity').text('');
          }

          if (getphone.val().length == 0) {
            getphone.focus();
            $('#ephone').text('Please valid your phone !!!');
            return false;
          } else {
            $('#ephone').text('');
          }
          var flagemail = false;
          if (getemailbill.val().length == 0) {
            getemailbill.focus();
            $('#eemailbill').text('Please valid your email!!!');
            return false;
          } else {
            $('#eemailbill').text('');
            
            checkemailbill(getemailbill.val(), (cb) => {
       
              if (cb == false) {
                $('#eemailbill').text('Email not exist !!!');
         
                getemailbill.focus();
              } else {
               
                let getcheckpayment = $('#payment').is(':checked');
                let getcheckpaypal = $('#paypal').is(':checked');
                
                if (getcheckpayment) {
                  alert('Vui lòng check mail để xác thực đơn hàng ..');
                  $.ajax({
                    url: '/bill',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                      type:'payment',
                      first_name: getfn.val(),
                      last_name: getln.val(),
                      street_address: getad.val(),
                      apartment_address:getad1.val(),
                      phone: getphone.val(),
                      email: getemailbill.val(),
                      note: getnote.val()
                    }),
                    success: res=>{
                      window.location.href='http://localhost:3000/';
                    }
                  });
                 // window.location.href='http://localhost:3000/index';
                  return;
                }
                if (getcheckpaypal == true && flagpaypal == true) {
                  alert('Đặt hàng thành công..\n Đơn hàng của bạn đang được xử lý.');
                  $.ajax({
                    url: '/bill',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                      type:'paypal',
                      first_name: getfn.val(),
                      last_name: getln.val(),
                      street_address: getad.val(),
                      apartment_address:getad1.val(),
                      phone: getphone.val(),
                      email: getemailbill.val(),
                      note: getnote.val()
                    }),
                    success: function(data, textStatus) {
                      window.location.href='http://localhost:3000/';
    }
                  })
                  //window.location.href='http://localhost:3000/index';
                  $('#eemailbill').text('');
                  return;
                } else {
                  alert('Vui lòng thanh toán trước bằng paypal !!!');
                  return;
                }
              }
            });
          }
          return true;
        }

        $('.site-btn').click((e) => {
          // e.preventDefault();
          // let getcheckpayment = $('#payment').is(':checked');
          // let getcheckpaypal = $('#paypal').is(':checked');
          
          // checkin4();
          $.ajax({
                    url: '/qrcode',
                    method: 'GET',
                    contentType: 'application/json',
                    data: JSON.stringify({
                   

                    }),
                    success: function(data, textStatus) {
                      window.location.href='http://localhost:3000/qrcode';
                    }
                  });
          
        });

        $('#zalopay-btn').click((e) => {
          // e.preventDefault();
          // window.location.href="https://sbgateway.zalopay.vn/openinapp?order=" + encodeURIComponent(b64Order);
          
        });
      });
      //This function displays Smart Payment Buttons on your web page.
    </script>
    
  </body>
  
</html>
